function makeDamMap(){console.log("making map");{var a=L.latLng(39.3853,-99.624),b=L.latLng(43.7552,-109.9951),c=L.latLngBounds(a,b),d=document.getElementById("dam-info-panel"),e=L.map("dam-map",{center:[42.105,-105.99],zoom:7,scrollWheelZoom:"false",zoomControl:"false",maxBounds:c});L.tileLayer("http://{s}.tiles.mapbox.com/v3/plattebasintl.jhkb20af/{z}/{x}/{y}.png",{minZoom:7,maxZoom:10}).addTo(e)}$.ajax({dataType:"json",url:"../data/dams.json",success:function(a){var b=L.geoJson(a,{onEachFeature:function(a,b){var c="<h5>"+a.properties.name+"</h5>",e="<h3>"+a.properties.name+"</h3>"+a.properties.info+'<img class="dam-image" src="http://'+a.properties.image+'"/><p><a class="dam-link" src= "http://'+a.properties.link+'">Read More</a></p>';b.bindPopup(c),b.on("click",function(){d.innerHTML=e})},pointToLayer:function(a,b){return new L.CircleMarker(b,{radius:a.properties.marker_radius,fillColor:"#b42f1d",color:"#b42f1d",opacity:0,fillOpacity:.6})}});e.addLayer(b)},error:function(a){console.log(a)}})}function listenForIntro(){function a(){d.addEvent("finish",b),$("#btn-intro").click(function(){$(".video-wrapper").fadeIn(),d.api("play"),$(".video-wrapper iframe").addClass("playing")}),$(".btn-skip").click(function(){$(".video-wrapper iframe").removeClass("playing"),d.api("stop"),b()});var a=!0;$("#btn-audio").click(function(){a?(d.api("setVolume",0),$(this).find("i").addClass("fa-volume-up").removeClass("fa-volume-off"),a=!1):($(this).find("i").addClass("fa-volume-off").removeClass("fa-volume-up"),d.api("setVolume",1),a=!0)})}function b(){d.api("unload"),$(".video-wrapper").remove(),$("#intro header").remove(),window.location.href="snow"}console.log("Listening to Video...");{var c=$("#video-title")[0],d=$f(c);$(".status")}d.addEvent("ready",a)}function setMasterStyles(){console.log("Setting Opening Styles");var a=$(window).height(),b=$(window).width();$(".image-featured-behind-full").height(a),$(".video-wrapper").height(a),$(".video-wrapper").width(b);(a-$("#video-title").height())/2;$("img.zoom").wrap('<span style="display:inline-block"></span>').css("display","block").parent().zoom({on:"grab",magnify:"2"}),$("body").animate({opacity:1})}function listenForAudioCntl(a){var b=!0;$(".sound-container").click(function(){b?(a[0].pause(),b=!1,$(".sound-container i").removeClass("fa-volume-off").addClass("fa-volume-up")):(a[0].play(),b=!0,$(".sound-container i").addClass("fa-volume-off").removeClass("fa-volume-up"))}),$(".sound-container").waypoint(function(b){a[0].play(),"down"==b?a.animate({volume:0},1e3):"up"==b&&a.animate({volume:1},1e3)},{offset:300})}function makePopChart(){console.log("making population chart");var a={top:20,right:80,bottom:30,left:50},b=900-a.left-a.right,c=800-a.top-a.bottom,d=d3.time.format("%Y").parse,e=d3.time.scale().range([0,b]),f=d3.scale.linear().range([c,0]),g=d3.scale.category20c(),h=d3.svg.axis().scale(e).orient("bottom"),i=d3.svg.axis().scale(f).orient("left"),j=d3.svg.line().interpolate("basis").x(function(a){return e(a.date)}).y(function(a){return f(a.population)}),k=d3.select("#pop-chart").append("svg").attr("width",b+a.left+a.right).attr("height",c+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");d3.tsv("../data/pop-selected-counties.tsv",function(a,b){g.domain(d3.keys(b[0]).filter(function(a){return"date"!==a})),b.forEach(function(a){a.date=d(a.date)});var l=g.domain().map(function(a){return{name:a,values:b.map(function(b){return{date:b.date,population:+b[a]}})}});e.domain(d3.extent(b,function(a){return a.date})),f.domain([d3.min(l,function(a){return d3.min(a.values,function(a){return a.population})}),d3.max(l,function(a){return d3.max(a.values,function(a){return a.population})})]),k.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(h),k.append("g").attr("class","y axis").call(i);var m=k.selectAll(".county").data(l).enter().append("g").attr("class","county");m.append("path").attr("class","line").attr("id",function(a){return a.name.replace(/\s+/g,"-").toLowerCase()}).attr("d",function(a){return j(a.values)}).style("stroke","lightgray").on("mouseover",function(){d3.select(this).style("stroke","steelblue").style("stroke-width","4px").moveToFront();d3.select(this).attr("id")}).on("mouseout",function(){d3.select(this).style("stroke","lightgray").style("stroke-width","1px");d3.select(this).attr("id")}),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.parentNode.appendChild(this.parentNode)})};var n=d3.select(".population-list").append("ul").selectAll(".county-table").data(l).enter().append("li").attr("class","county-list-entry");n.append("p").attr("id",function(a){return a.name.replace(/\s+/g,"-").toLowerCase()}).text(function(a){return a.name}).on("mouseover",function(){var a=d3.select(this).attr("id");d3.select("#"+a).style("stroke","steelblue").style("stroke-width","4px").moveToFront()}).on("mouseout",function(){var a=d3.select(this).attr("id");d3.select("#"+a).style("stroke","lightgray").style("stroke-width","1px")}),d3.select(".county #scotts-bluff-county-ne").style("stroke","#b42f1d","important").style("stroke-width","2px","important").moveToFront()})}function makeSnowChart(){console.log("making snow chart");var a={top:0,right:0,bottom:0,left:0},b=300,c=200,d=d3.time.format("%b-%y").parse;bisectDate=d3.bisector(function(a){return a.date}).left;var e=d3.time.scale().range([0,b]),f=d3.scale.linear().range([c,0]),g=d3.scale.category20c(),h=(d3.svg.axis().scale(e).orient("bottom"),d3.svg.axis().scale(f).orient("left"),d3.svg.line().interpolate("basis").x(function(a){return e(a.date)}).y(function(a){return f(a.swe)})),i=d3.select("#snow-chart1").append("svg").attr("width",b+a.left+a.right).attr("height",c+a.top+a.bottom).append("g").attr("transform","translate("+a.left+","+a.top+")");d3.tsv("../data/roach-monthly-data.tsv",function(a,b){function j(){var a=e.invert(d3.mouse(this)[0]),c=bisectDate(b,a,1),d=b[c-1],g=b[c],h=a-d.date>g.date-a?g:d;m.attr("transform","translate("+e(h.date)+","+f(h.swe)+")"),console.log(h.swe),m.text(h.swe)}g.domain(d3.keys(b[0]).filter(function(a){return"date"!==a})),b.forEach(function(a){a.date=d(a.date)});var k=g.domain().map(function(a){return{name:a,values:b.map(function(b){return{date:b.date,swe:+b[a]}})}});e.domain(d3.extent(b,function(a){return a.date})),f.domain([d3.min(k,function(a){return d3.min(a.values,function(a){return a.swe})}),d3.max(k,function(a){return d3.max(a.values,function(a){return a.swe})})]);var l=d3.select("#snow-chart1").append("div").attr("class","remove").style("position","absolute").style("display","none").style("z-index","19").style("width","2px").style("height",c).style("top","15px").style("bottom","15px").style("left","0px").style("background","gray");d3.select("#snow-chart1").on("mousemove",function(){mousex=d3.mouse(this),mousex=mousex[0]+15,l.style("display","block").style("left",mousex+"px")}).on("mouseover",function(){mousex=d3.mouse(this),mousex=mousex[0]+15,l.style("display","block").style("left",mousex+"px")}).on("mouseout",function(){l.style("display","none")}).on("mousemove",j);var m=d3.select("#snow-text1"),n=i.selectAll(".measurement").data(k).enter().append("g").attr("class","measurement");n.append("path").attr("class","line").attr("id",function(a){return a.name.replace(/\s+/g,"-").toLowerCase()}).attr("d",function(a){return h(a.values)}),d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.parentNode.appendChild(this.parentNode)})}})}var w=!0;$("#toggle-canals").click(function(){w?($("#np-map").attr("src","../media/north-platte-canals.png"),w=!1):($("#np-map").attr("src","../media/north-platte-river.png"),w=!0)}),setTimeout(function(){$(".opening-pull-quote").fadeOut("slow")},4e3),setTimeout(function(){$(".opening-title-right").fadeIn("slow")},5e3),$(".intro-nav-button").click(function(){$(".intro-nav-container").toggleClass("hidden"),$("#intro-nav").toggleClass("down")}),$("#intro-menu img").hover(function(){$("#intro-nav-title").toggleClass("hidden"),$("#intro-nav-title").text($(this).attr("data-title"))}),$(document).ready(function(){setMasterStyles()}),$(window).resize(function(){setMasterStyles()}),$(window).load(function(){$("body").is("#intro")?(console.log("INTRO"),listenForIntro()):$("body").is("#part-one")?(console.log("PART ONE"),listenForAudioCntl($("#snow-sounds")),makeSnowChart()):$("body").is("#part-two")?(console.log("PART TWO"),makeDamMap()):$("body").is("#part-three")&&(console.log("PART THREE"),makePopChart())});